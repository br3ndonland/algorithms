# Python packaging

## Virtual environments, dependencies, and packaging

### `venv`

## Virtual environments and dependencies

### Pipenv

- **[Pipenv](https://pipenv.readthedocs.io/en/latest/)** was previously used to manage the development virtual environment for this project.
- **The future of Pipenv is unclear.** It went all of 2019 without a major release, and has many bugs. Jacob Kaplan-Moss (Django co-creator) has commented on how "the lead of Pipenv was someone with a history of not treating his collaborators well," and on the "bugs and rapid API changes" of Pipenv. Many developers are switching to [Poetry](https://python-poetry.org).
  - [Jacob Kaplan-Moss | Blog 20191111: My Python development environment, 2020 edition](https://jacobian.org/2019/nov/11/python-environment-2020/)
  - [Telnyx | 20200124 Nick Timkovich: RIP Pipenv](https://medium.com/telnyx-engineering/rip-pipenv-tried-too-hard-do-what-you-need-with-pip-tools-d500edc161d4)

### venv

Python 3 is bundled with the [`venv` module](https://docs.python.org/3/tutorial/venv.html) for creation of virtual environments.

1. **Install and activate Python virtual environment**: The shell commands in the code block below will create a Python virtual environment, activate the virtual environment and display a modified virtual environment prompt
2. **Install required Python modules into the virtual environment**: Use `pip` to install required modules listed in _requirements.txt_. The modules will be installed locally within the virtual environment. The _requirements.txt_ file is generated by running `pip freeze > requirements.txt`.
3. **Start application**: Use the appropriate command to start your application within the virtual environment. For Flask, this is usually `python app.py` or `python -m flask run`.

```sh
~
❯ cd path/to/repo

# 1. install and activate virtual env
~/path/to/repo
❯ python3 -m venv venv

~/path/to/repo
❯ . venv/bin/activate

# 2. install modules
~/path/to/repo
(venv) path ❯ pip install -r requirements.txt

# 3. run app: the example below works for Flask
~/path/to/repo
(venv) path ❯ python app.py
```

### virtualenv

[Virtualenv](https://virtualenv.pypa.io/en/latest/) is similar to `venv`, but with additional features.

## Packaging

### flit

_TODO_

### Poetry

[Poetry](https://python-poetry.org/) is recommended for Python virtual environments, dependency management, and packaging.

#### Virtual environments

_TODO_

#### Dependency management

- To learn how to use semver syntax, check out the [npm semver calculator](https://semver.npmjs.com/).

#### Packaging

_TODO_

### `setuptools`

_TODO_

### tox

[Tox](https://pypi.org/project/tox/)

## Confusing configuration files

### Background

_TODO_: write up notes in actual sentences

I got interested in this topic during a Boston Python User Group Meetup event.

Repo: [br3ndonland/test3](https://github.com/br3ndonland/test3)

- Moved tests to tests directory, didn't run -> conftest.py
- Moved Python modules to separate directory, didn't run -> `__init__.py`
- setup.py: https://docs.pytest.org/en/latest/goodpractices.html, https://github.com/br3ndonland/test3/commit/aa68546fc08edd835e93dff6349914966fb67ec6

### _\_\_init\_\_.py_

_TODO_

### _conftest.py_

In many ways, `conftest.py` is like `setup.py` for pytest. It helps pytest understand your project structure so that pytest can find Python modules to test.

If your tests and modules are in separate directories and you don't have `conftest.py`, pytest may throw a `ModuleNotFoundError`. Pytest finds the tests, but the tests can't find the modules they `import` from the root directory. A solution, as explained on [Stack Overflow](https://stackoverflow.com/questions/10253826), is to simply create an empty _conftest.py_ file in the root directory. This seems strange to me.

### _setup.cfg_

_TODO_

### _setup.py_

The `setup.py` [setup configuration file](https://docs.python.org/3/distutils/configfile.html) helps Python understand your project structure. It's mostly used by [`setuptools` ](https://setuptools.readthedocs.io/en/latest/setuptools.html) to distribute Python packages on [PyPI](https://pypi.org/).

For example, if your tests are in a sub-directory like _test/_, adding `setup.py` helps pytest locate Python modules to load when running tests.

To use the `setup.py` file during local development, simply run `pip install -e .` as described in the [`pip install -e` docs](https://pip.pypa.io/en/stable/reference/pip_install/#editable-installs) and the [pytest docs on good integration practices](https://docs.pytest.org/en/latest/goodpractices.html).

Poetry projects don't need a separate `setup.py` because it's managed automatically by Poetry. Attempting to use a separate `setup.py` file with Poetry may result in errors, as described in [GitHub issue 1279](https://github.com/python-poetry/poetry/issues/1279).

### _pyproject.toml_

As explained in the README for the Black autoformatter, _pyproject.toml_ can replace _setup.cfg_ and _setup.py_.
